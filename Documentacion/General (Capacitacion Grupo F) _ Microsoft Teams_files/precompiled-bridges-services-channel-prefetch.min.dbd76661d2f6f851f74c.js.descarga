(window.webPackBridgeJsonp=window.webPackBridgeJsonp||[]).push([[33],{"4240efd871ae15138fcf":function(e,t,r){"use strict";r.d(t,"a",function(){return a});var a=angular.element(document.body).injector().get("bridgeLoggingService")},"7ae84428caea0eb3c5b1":function(e,t,r){"use strict";var a,n;!function(e){e[e.Created=0]="Created",e[e.Opened=1]="Opened",e[e.Failed=2]="Failed",e[e.Memory=3]="Memory"}(a||(a={})),function(e){e[e.Nuked=0]="Nuked",e[e.Cleaned=1]="Cleaned",e[e.Upgraded=2]="Upgraded",e[e.Wiped=3]="Wiped",e[e.Blocked=4]="Blocked",e[e.Downgraded=5]="Downgraded"}(n||(n={})),r.d(t,"a",function(){return a})},db5bd6fd022a1b6b858b:function(e,t,r){"use strict";r.r(t);var a,n=r("98bae3dbabd51089d613"),i=r("94a755535d135f12850c"),o=r("dc969c026d388e81ff0e"),s=r("e9d155a6651c0bf6c9b0"),c=r("9ba97cc998d0be4df04a"),d=r("cdb9a7d2db44c7a9f4dd"),l={ODB:865,OneDrive:!0},u={ODB:270,OneDrive:!0},f={ODB:788,OneDrive:!0},p={ODB:268,OneDrive:!0},h={ODB:1235},g={ODB:851},b={ODB:1058},_={ODB:1210},w={ODB:1174},m=function(){return function(){this.startTimeMark=(new Date).getTime(),this.deferredListData=!1}}(),v=function(){function e(){}return e.prefetchData=function(t){return e._prefetchData?e._prefetchData[t]:null},e.initPrefetchData=function(t){return e._prefetchData||(e._prefetchData={}),e._prefetchData[t]=new m},e.setPrefetchData=function(t,r){e._prefetchData||(e._prefetchData={}),e._prefetchData[t]=r},e.clearPrefetchData=function(t){e._prefetchData&&e._prefetchData[t]&&delete e._prefetchData[t]},e.getAdditionalPostData=function(e,t){return e.isListDataRenderOptionChangeFeatureEnabled=!t||t(f),e.isSpotlightFeatureEnabled=!0,o.getAdditionalPostData(e)},e.createHashCode=function(t,r){return"listviewdataprefetch-"+e._hashCode(decodeURIComponent(t))+"-"+e._hashCode(r)},e._hashCode=function(e){var t=0;if(!e||0===e.length)return t;for(var r=0;r<e.length;r++){t=(t<<5)-t+e.charCodeAt(r),t&=t}return t},e.shouldLogError=!0,e}();!function(e){e[e.Loading=0]="Loading",e[e.Files=1]="Files",e[e.FilePicker=2]="FilePicker",e[e.FolderPicker=3]="FolderPicker",e[e.Photos=4]="Photos",e[e.TextFileEditor=5]="TextFileEditor",e[e.AccountChooser=6]="AccountChooser",e[e.StorageInfo=7]="StorageInfo",e[e.StorageOptions=8]="StorageOptions",e[e.AppData=9]="AppData",e[e.Error=10]="Error",e[e.SyncOnboarding=11]="SyncOnboarding",e[e.Share=12]="Share",e[e.Wedcs=13]="Wedcs",e[e.OneUp=14]="OneUp",e[e.PhotoPreferences=15]="PhotoPreferences",e[e.Embed=16]="Embed",e[e.SyncPlaceholders=17]="SyncPlaceholders",e[e.Restore=18]="Restore",e[e.WinPhoneBackup=19]="WinPhoneBackup",e[e.ValidatePermission=20]="ValidatePermission",e[e.RansomwareDetection=21]="RansomwareDetection",e[e.Settings=22]="Settings",e[e.Unlock=23]="Unlock",e[e.MobileAppUpsell=24]="MobileAppUpsell",e[e.Provisioning=25]="Provisioning",e[e.FileRequest=26]="FileRequest",e[e.CreateListPage=27]="CreateListPage"}(a||(a={}));var D=a,P=r("c0ec8ed08a9b4b107886"),C="21";["_spPageContextInfo","__themeState__","mark","require","requirejs","define","_onErrorHandler","_perfMarks","_spModuleLink","__onePageContext","__stylesheet__","__globalSettings__"].concat(Object.keys(n));var O={id:!0,parent:!0,p:!0,embed:!0,sortField:!0,isAscending:!0,enableFeatures:!0,disableFeatures:!0,FolderCTID:!0};function F(e,t,r,a,n,i,F,I){if(i&&r&&((e=r.inputPageContextInfo).isSPO=!0,window._spPageContextInfo&&void 0!==window._spPageContextInfo.listBaseTemplate&&window._spPageContextInfo.listBaseTemplate<=0&&e.listBaseTemplate>0&&(window._spPageContextInfo.listBaseTemplate=e.listBaseTemplate)),e&&null!==window.location&&null!==window.location.search){var y=e.webAbsoluteUrl,k=e.webTemplate,T=e.listBaseTemplate,U=!1,L="",A="",B=void 0===e.isSPO||e.isSPO;void 0!==e.webTitle&&(U=!!e.isSiteAdmin,L=e.serverRedirectedUrl,A=e.webServerRelativeUrl);var j=L&&L.indexOf("?")>=0?L.substring(L.indexOf("?")+1):"",x=window.location.search.slice(1)+(j?"&"+j:"");t||(t=c.a(x));var M="21"!==k,E=-1!==[101,109,115,119].indexOf(T),q="",V="";M?(V=e.listUrl,q=R(e,t,"listId",!0)):V=A+"/Documents";var H=t.listurl;if(M){if(!q&&!V)return;if(H&&e.viewId)return}else for(var N in t)if(!O[N])return;var J=function(e){var t=e.id,r=e.parent;return r?r.replace(/\/+$/,""):e.p===""+D.Embed&&t&&t.substring(0,t.lastIndexOf("/"))}(t),X=21===Number(e.webTemplate),z=!n||X&&n&&n(h)||!X&&n&&n(g),W=z?function(){var r=R(e,t,"viewId",!0),a=R(e,t,"webAbsoluteUrl",!0),n=t.id,i=new P.b({webAbsoluteUrl:a}).build().segment("web").method("GetList",V).segment("RenderListDataAsStream"),o=n||t.RootFolder;o&&(i=i.parameter("RootFolder",{raw:s.a.encodeURIComponent(o)})),r&&(i=i.parameter("View",{raw:r||""}));var c=R(e,t,"ViewPath",!0);if(c&&!r&&M&&(i=i.parameter("ViewPath",c)),!R(e,t,"useFiltersInViewXml",!0))for(var d in t)0===d.lastIndexOf("Filter",0)&&(i=i.parameter(d,t[d]));var l=R(e,t,"sortField");if(l){var u=R(e,t,"isAscending")||"";i=(i=i.parameter("SortField",{raw:l})).parameter("SortDir",{raw:"false"===u.toLowerCase()?"Desc":"Asc"})}return i.toString()}():function(){var r=R(e,t,"viewId",!0),a=t.id,i=s.a.escapeUrlForCallback(y)+"/_api/web/"+(V?"GetList(@listUrl)":"lists/getById('"+q+"')")+"/RenderListDataAsStream?"+(V?"@listUrl='"+(c=V,s.a.encodeURIComponent((c||"").replace(/'/g,"''")))+"'&":"")+(J&&r?"View=":"View="+(r||"")),o=a||t.RootFolder;var c;o&&!J&&(i+="&RootFolder="+s.a.encodeURIComponent(o));var d=R(e,t,"ViewPath",!0);if(d&&!r&&M&&(i+="&ViewPath="+s.a.encodeURIComponent(d)),!t.useFiltersInViewXml)for(var l in t)0===l.lastIndexOf("Filter",0)&&(i+="&"+l+"="+t[l]);var u=!M&&n&&n(b)&&"LinkFilename",f=R(e,t,"sortField")||u;f&&!J&&(i+="&SortField="+f,i+="&SortDir="+("false"===(R(e,t,"isAscending")||"").toLowerCase()?"Desc":"Asc"));return i}(),G="";J?G=o.getViewXml({itemRefs:[t.id],requestMetaInfo:!0,recurseInFolders:!0,requestCommentFlags:n&&n(w),pageSize:1}):M||(G=o.getViewXml({sortField:R(e,t,"sortField")||"LinkFilename",itemIds:void 0,isAscending:R(e,t,"isAscending")||"true",pageSize:100,requestCommentFlags:n&&n(w),requestMetaInfo:n&&(n(p)||n(u))}));var Q=!(M||!U||R(e,t,"sortField")||!n||!n(b)),K=void 0;J&&(K={viewXml:G,needsSchema:!0,needsParentInfo:!0,isListDataRenderOptionChangeFeatureEnabled:!n||n(f)});var $=R(e,t,"viewId",!0,!0),Y=!!$&&d.default.normalizeLower($,!1)!==d.default.normalizeLower(e.viewId,!1),Z=K||{needsSchema:!0,needsContentTypes:M,needsQuickLaunch:n&&!n(_)&&M&&"64"!==k,needsSpotlight:M&&E,needsViewMetadata:M,viewXml:G,requestDatesInUtc:k===C&&n&&n(l),allowMultipleValueFilterForTaxonomyFields:!!B||void 0,needClientSideComponentManifest:Y,needUpdatePageContext:!!i||z,mergeDefaultView:Q},ee=R(e,t,"groupBy");ee&&(Z.groupByOverride=ee,Z.groupReplace=!1);var te,re=v.getAdditionalPostData(Z),ae=v.createHashCode(W,re);if(I&&F)F(ae,"");else if(te=F?new m:v.initPrefetchData(ae),window.DeferredListDataComplete=function(){S.bind(void 0,W)()},!S(W)){var ne=new XMLHttpRequest;ne.open("POST",W,!0),ne.setRequestHeader("accept","application/json;odata=verbose"),ne.setRequestHeader("Content-Type","application/json;odata=verbose");var ie=V?"listUrl="+s.a.encodeURIComponent(V):"list="+q;M&&(ie="NAVIGATIONSTRUCTURE, "+ie),ne.setRequestHeader("X-SP-REQUESTRESOURCES",ie),a&&ne.setRequestHeader("Authorization",a),ne.onreadystatechange=function(){if(4===ne.readyState&&!te.listData){var t=400;try{t=ne.status}catch(e){}te.correlationId=ne.getResponseHeader("SPRequestGuid"),te.responseCode=t,t<300&&(te.listData=ne.responseText,te.serverDuration=Number(ne.getResponseHeader("SPClientServiceRequestDuration"))),i&&r&&r.onePagePrefetchCompleteCallback?r.onePagePrefetchCompleteCallback(t,ne.responseText,function(r){e=r,te.completedCallback&&te.completedCallback(t)}):te.completedCallback&&te.completedCallback(t),F&&F(ae,ne.responseText)}},ne.send(re)}}}function S(e){if(window.g_payload&&window.g_listData){var t=v.createHashCode("ListContenTypes","ListContenTypes");v.initPrefetchData(t).listData=window.g_listData.ListContenTypes,t=v.createHashCode(e,JSON.stringify(window.g_payload)),window.DeferredListDataExpectedHash=t;var r=v.prefetchData(t);if(r)return r.listData=JSON.stringify(window.g_listData),r.deferredListData=!0,r.completedCallback&&r.completedCallback(0,!0),r.contentTypesCallback&&r.contentTypesCallback(),!0}return!1}function R(e,t,r,a,n){var i=t[a?r.toLowerCase():r]||!n&&e[r];if(i){var o=i.match(/\{(.*)\}/);return o?o[1]:i}return i}var I=r("a689a10faf924dde39cc"),y=r("eeb7e586e78ae434f9f6"),k={steps:{files_list_data_received:"list_data_received",write_to_db_Success:"written_to_IndexDB",failed_to_fetch_hashcode:"Failed_to_fetch_hashcode",prefetch_call_triggered:"prefetch_call_triggered"},errorMessage:{writeToDbFailed:"Failed to write to IndexDB",failToParseJSONResponse:"Failed to pass JSON response",prefetchErrorResponse:"Error response from prefetch call",cacheAlreadyPopulated:"Cache is already populated",cachePersistorLoadFailure:"Failed to get cache persistor instance",indexedDbFetchFailed:"Failed to fetch data from indexedDB"}},T={listBaseTemplate:101},U={sortField:"Modified",isAscending:"false"};function L(e){return!!e&&!!e.error}var A=r("a045aecb03dad90a1bba");function B(e,t,r,a,o,s){return Object(n.__awaiter)(this,void 0,void 0,function(){var c,d,l,u,f,p;return Object(n.__generator)(this,function(h){switch(h.label){case 0:return c=s||t,d=Object(n.__assign)({webAbsoluteUrl:e,listUrl:c},T),l=Object(n.__assign)({RootFolder:t},U),I.a.initialize(o),[4,j(d,l,a)];case 1:u=h.sent(),h.label=2;case 2:return h.trys.push([2,4,,5]),[4,E(u,a)];case 3:return h.sent(),a.incomplete({message:k.errorMessage.cacheAlreadyPopulated}),[2,Promise.resolve()];case 4:return h.sent(),f=function(e,t,r,a){var o=this;return new Promise(function(s,c){return Object(n.__awaiter)(o,void 0,void 0,function(){return Object(n.__generator)(this,function(n){return a.mark(k.steps.prefetch_call_triggered),F(e,t,void 0,"Bearer "+r,void 0,void 0,Object(i.partialRight)(V,a,s,c)),[2]})})})}(d,l,r,a),(p=A.a.getInstance()).populatePrefetchMemoryRecord(u,f),[2,f.then(function(){p.populatePrefetchMemoryRecord(u)}).catch(function(){p.removePrefetchRecord(u)})];case 5:return[2]}})})}function j(e,t,r){return Object(n.__awaiter)(this,void 0,void 0,function(){return Object(n.__generator)(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,x(e,t)];case 1:return[2,a.sent()];case 2:return a.sent(),r.mark(k.steps.failed_to_fetch_hashcode),[2,void 0];case 3:return[2]}})})}function x(e,t){return new Promise(function(r,a){F(e,t,void 0,void 0,void 0,void 0,Object(i.partialRight)(M,r,a),!0)})}function M(e,t,r,a){if(e)return r(e);a()}function E(e,t){return Object(n.__awaiter)(this,void 0,void 0,function(){var r,a,i;return Object(n.__generator)(this,function(n){switch(n.label){case 0:if(!e)return[2,Promise.reject()];if((a=A.a.getInstance()).isPrefetchStateUpdated(e))return[2,Promise.resolve()];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,I.a.getInstance()];case 2:return r=n.sent(),[3,4];case 3:return i=n.sent(),t.fail({message:k.errorMessage.cachePersistorLoadFailure,reason:i}),[2,Promise.reject()];case 4:return n.trys.push([4,6,,7]),[4,q(e,r)];case 5:return n.sent()?(a.populatePrefetchMemoryRecord(e),[2,Promise.resolve()]):[2,Promise.reject()];case 6:return n.sent(),t.fail({message:k.errorMessage.indexedDbFetchFailed}),[2,Promise.reject()];case 7:return[2]}})})}function q(e,t){return Object(n.__awaiter)(this,void 0,void 0,function(){return Object(n.__generator)(this,function(r){return[2,t.getDataUsingKey(e,y.b.teams_requests)]})})}function V(e,t,r,a,i){var o=A.a.getInstance();try{var s=JSON.parse(t);if(L(s))return r.fail({reason:{code:s.error.code,message:k.errorMessage.prefetchErrorResponse}}),i();r.mark(k.steps.files_list_data_received),function(e,t,r){return Object(n.__awaiter)(this,void 0,void 0,function(){return Object(n.__generator)(this,function(a){switch(a.label){case 0:return[4,I.a.getInstance()];case 1:return[2,H(a.sent(),e,t,r)]}})})}(e,s,r).then(function(){o.populatePrefetchMemoryRecord(e),r.stop(),a(s)}).catch(function(e){r.fail({reason:e}),i()})}catch(e){r.fail({reason:k.errorMessage.failToParseJSONResponse}),i()}}function H(e,t,r,a){return Object(n.__awaiter)(this,void 0,void 0,function(){return Object(n.__generator)(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,e.persistData(t,r,y.b.teams_requests)];case 1:return n.sent(),[2,a.mark(k.steps.write_to_db_Success)];case 2:throw n.sent(),k.errorMessage.writeToDbFailed;case 3:return[2]}})})}r.d(t,"prefetchAndPersistListData",function(){return B}),r.d(t,"isError",function(){return L})}}]);
//# sourceMappingURL=precompiled-bridges-services-channel-prefetch.min.dbd76661d2f6f851f74c.js.map